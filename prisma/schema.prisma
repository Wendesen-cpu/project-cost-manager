generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Employee {
  id           String              @id @default(uuid())
  firstName    String
  lastName     String
  email        String              @unique
  password     String
  monthlyCost  Float
  vacationDays Int                 @default(0)
  role         String              @default("EMPLOYEE")
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  status       String              @default("PENDING")
  createdById  String?
  approvedById String?
  approvedBy   Admin?              @relation("AdminApprovals", fields: [approvedById], references: [id], onDelete: SetNull)
  projects     ProjectAssignment[]
  vacations    VacationLog[]
  workLogs     WorkLog[]
}

model Project {
  id                String              @id @default(uuid())
  name              String
  description       String?
  startDate         DateTime
  endDate           DateTime?
  status            String              @default("ACTIVE")
  paymentType       String              @default("FIXED")
  totalPrice        Float?
  hourlyRate        Float?
  fixedMonthlyCosts Float               @default(0)
  fixedTotalCosts   Float               @default(0)
  ownerId           String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  owner             Admin               @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members           ProjectAssignment[]
  workLogs          WorkLog[]
}

model ProjectAssignment {
  id         String   @id @default(uuid())
  employeeId String
  projectId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([employeeId, projectId])
}

model WorkLog {
  id         String   @id @default(uuid())
  employeeId String
  projectId  String
  date       DateTime
  hours      Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model VacationLog {
  id         String   @id @default(uuid())
  employeeId String
  date       DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
}

model Admin {
  id                String     @id @default(uuid())
  firstName         String     @default("System")
  lastName          String     @default("Admin")
  email             String     @unique
  password          String
  role              String     @default("PM")
  status            String     @default("PENDING")
  createdById       String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  approvedEmployees Employee[] @relation("AdminApprovals")
  ownedProjects     Project[]  @relation("ProjectOwner")
}

model Otp {
  id        String   @id @default(uuid())
  email     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
}
